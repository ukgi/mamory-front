<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2c6e17f793fc910fcfec58ba982d12ff"
    ></script>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2c6e17f793fc910fcfec58ba982d12ff&libraries=services"
    ></script>
    <title>kakao 지도</title>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/exif-js"
    ></script>
  </head>
  <body>
    <div id="map" style="width: 500px; height: 400px"></div>
    <!-- 이미지 입력 -->
    <input
      type="file"
      id="uploadFile"
      onChange="uploadImgPreview();"
      accept="image/*"
    /><br />
    <img id="thumbnailImg" src="" width="300" />

    <script>
      var container = document.getElementById("map");
      var options = {
        center: new kakao.maps.LatLng(37.5666805, 126.9784147),
        level: 3,
      };
      var map = new kakao.maps.Map(container, options);

      function uploadImgPreview() {
        // 업로드 파일 읽기
        const fileInfo = document.getElementById("uploadFile").files[0];
        const reader = new FileReader();

        // readAsDataURL( )을 통해 파일을 읽어 들일때 onload가 실행
        reader.onload = function () {
          EXIF.getData(fileInfo, () => {
            var exifLong = EXIF.getTag(fileInfo, "GPSLongitude");
            var exifLat = EXIF.getTag(fileInfo, "GPSLatitude");
            var exifLongRef = EXIF.getTag(fileInfo, "GPSLongitudeRef");
            var exifLatRef = EXIF.getTag(fileInfo, "GPSLatitudeRef");

            // 객체 내용 확인하기
            console.dir(exifLong);
            console.dir(exifLat);
            console.dir(exifLongRef);
            console.dir(exifLatRef);

            if (exifLatRef == "N") {
              var latitude =
                exifLat[0] * -1 + (exifLat[1] * -60 + exifLat[2] * -1) / 3600;
            } else {
              var latitude = exifLat[0] + (exifLat[1] * 60 + exifLat[2]) / 3600;
            }

            if (exifLongRef == "E") {
              var longitude =
                exifLong[0] * -1 +
                (exifLong[1] * -60 + exifLong[2] * -1) / 3600;
            } else {
              var longitude =
                exifLong[0] + (exifLong[1] * 60 + exifLong[2]) / 3600;
            }

            wtmX = Math.abs(latitude);
            wtmY = Math.abs(longitude);

            var container = document.getElementById("map");
            var options = {
              center: new kakao.maps.LatLng(wtmX, wtmY), //wtmX, wtmY 받아옴
              level: 3,
            };

            var map = new kakao.maps.Map(container, options);

            var markerPosition = new kakao.maps.LatLng(wtmX, wtmY);

            var marker = new kakao.maps.Marker({
              position: markerPosition,
            });

            marker.setMap(map);
          });

          // 파일의 URL을 Base64 형태로 가져온다.
          document.getElementById("thumbnailImg").src = reader.result;
        };

        if (fileInfo) {
          // readAsDataURL( )을 통해 파일의 URL을 읽어온다.
          reader.readAsDataURL(fileInfo);
          console.log(fileInfo);
        }
      }
    </script>
  </body>
</html>
